# 🔄 반품 관리 시스템 사용 가이드

## 📋 목차
1. [시스템 개요](#시스템-개요)
2. [시작하기](#시작하기)
3. [네이버 계정 설정](#네이버-계정-설정)
4. [반품 관리 사용법](#반품-관리-사용법)
5. [문제 해결](#문제-해결)

---

## 🎯 시스템 개요

이 시스템은 쿠팡 반품/취소 요청을 자동으로 네이버 스마트스토어에서 처리하는 자동화 도구입니다.

### 주요 기능
- ✅ 쿠팡 반품/취소 요청 자동 조회
- ✅ 네이버 스마트스토어 자동 반품 신청
- ✅ 네이버 스마트스토어 자동 주문 취소
- ✅ 배치 처리 지원 (여러 건 동시 처리)
- ✅ 처리 상태 추적 및 통계

---

## 🚀 시작하기

### 1. 시스템 실행

#### 방법 1: 간편 실행 (추천)
```bash
# 루트 디렉토리에서 실행
START_ALL.bat
```
이 명령어는 백엔드와 프론트엔드를 모두 자동으로 시작합니다.

#### 방법 2: 개별 실행
```bash
# 터미널 1: 백엔드
cd backend
start_server.bat

# 터미널 2: 프론트엔드
cd frontend
start_frontend.bat
```

### 2. 접속 URL
- **프론트엔드**: http://localhost:3000
- **백엔드 API**: http://localhost:8000
- **API 문서**: http://localhost:8000/docs

---

## 🔑 네이버 계정 설정

반품 관리 기능을 사용하려면 먼저 네이버 API 계정을 등록해야 합니다.

### Step 1: 네이버 개발자 센터 설정

1. **네이버 개발자 센터** 접속
   - URL: https://developers.naver.com/

2. **애플리케이션 등록**
   - "Application > 애플리케이션 등록" 클릭
   - 애플리케이션 이름 입력 (예: "쿠팡 반품 자동화")
   - 사용 API: "네이버 로그인" 선택

3. **서비스 환경 설정**
   - PC 웹: `http://localhost:3000`
   - Callback URL: `http://localhost:3000/naver/callback`

4. **Client ID와 Client Secret 복사**
   - 등록 후 발급되는 Client ID와 Client Secret을 메모

### Step 2: 시스템에 네이버 계정 등록

1. **네이버 계정 메뉴 접속**
   - 좌측 사이드바에서 "네이버 계정" 클릭

2. **계정 추가 버튼 클릭**
   - 우측 상단 "계정 추가" 버튼 클릭

3. **계정 정보 입력**

   #### 기본 정보
   - **계정 이름**: 식별하기 쉬운 이름 (예: "메인 네이버 계정")
   - **설명**: 선택사항 (예: "반품 처리용 계정")

   #### 네이버 API 인증 정보
   - **Client ID**: 개발자 센터에서 복사한 Client ID
   - **Client Secret**: 개발자 센터에서 복사한 Client Secret
   - **Callback URL**: `http://localhost:3000/naver/callback` (기본값)

   #### 네이버 로그인 정보 (선택사항)
   - **네이버 아이디**: Selenium 자동화에 사용
   - **네이버 비밀번호**: Selenium 자동화에 사용

   ⚠️ **주의**: 이 정보는 암호화되어 저장됩니다.

4. **기본 계정 설정**
   - "기본 계정으로 설정" 체크박스 선택 (첫 계정인 경우 권장)

5. **등록 버튼 클릭**

### Step 3: 연결 테스트

1. **테스트 버튼 클릭**
   - 등록된 계정 카드에서 "연결 테스트" 아이콘 클릭

2. **OAuth 로그인**
   - 새 창이 열리면 네이버 로그인 진행
   - 앱 권한 승인

3. **성공 확인**
   - "네이버 계정 연결이 정상입니다" 알림이 표시되면 성공

---

## 📦 반품 관리 사용법

### Step 1: 쿠팡에서 반품 조회

1. **반품 관리 메뉴 접속**
   - 좌측 사이드바에서 "반품 관리" 클릭

2. **쿠팡에서 조회 버튼 클릭**
   - 우측 상단 "쿠팡에서 조회" 버튼 클릭
   - 최근 7일간의 반품/취소 요청을 자동으로 조회

3. **조회 결과 확인**
   - 통계 카드에서 전체 반품, 대기중, 처리완료, 실패 건수 확인
   - 테이블에서 개별 반품 내역 확인

### Step 2: 처리할 반품 선택

1. **개별 선택**
   - 테이블의 체크박스를 클릭하여 처리할 반품 선택

2. **전체 선택**
   - 상단 체크박스를 클릭하여 미처리 반품 전체 선택

3. **필터 활용**
   - **상태 필터**: 대기/처리중/완료/실패로 필터링
   - **네이버 처리 필터**: 미처리/처리완료로 필터링

### Step 3: 네이버 자동 처리

1. **네이버 자동 처리 버튼 클릭**
   - 선택한 반품 건수가 표시됩니다 (예: "네이버 자동 처리 (5)")

2. **네이버 로그인 정보 입력**
   - 프롬프트에서 네이버 아이디 입력
   - 네이버 비밀번호 입력

   💡 **팁**: 네이버 계정 등록 시 로그인 정보를 저장했다면 자동으로 사용됩니다.

3. **자동 처리 진행**
   - Selenium이 자동으로 네이버에 로그인
   - 각 반품 건에 대해:
     - **출고중지요청 (RELEASE_STOP_UNCHECKED)**: 네이버 주문 취소
     - **반품접수 (RETURNS_UNCHECKED)**: 네이버 반품 신청

4. **처리 결과 확인**
   - 완료 알림에서 처리된 건수 확인
   - 테이블에서 "네이버 처리" 열이 "완료"로 변경됨
   - 통계 카드가 업데이트됨

### 처리 로직

#### 상태별 자동 처리 방식

| 쿠팡 상태 | 네이버 처리 방식 | 설명 |
|----------|----------------|------|
| RELEASE_STOP_UNCHECKED | 주문 취소 | 출고 전 취소 요청 |
| RETURNS_UNCHECKED | 반품 신청 | 배송 후 반품 요청 |
| VENDOR_WAREHOUSE_CONFIRM | 반품 신청 | 입고 완료 후 반품 |
| REQUEST_COUPANG_CHECK | - | 쿠팡 확인 대기 |
| RETURNS_COMPLETED | - | 이미 완료됨 |

---

## 📊 통계 및 모니터링

### 대시보드 통계

- **전체 반품**: 시스템에 등록된 총 반품 건수
- **대기중**: 아직 처리되지 않은 반품
- **처리완료**: 네이버에서 성공적으로 처리된 반품
- **실패**: 처리 중 오류가 발생한 반품

### 상태 추적

각 반품 건의 상태:
- **pending** (대기): 조회만 완료, 처리 대기
- **processing** (처리중): 네이버 처리 진행 중
- **completed** (완료): 네이버 처리 성공
- **failed** (실패): 네이버 처리 실패

---

## 🔧 문제 해결

### 1. 쿠팡 조회 실패

**증상**: "쿠팡 반품 조회에 실패했습니다"

**해결 방법**:
1. `.env` 파일에서 쿠팡 API 키 확인
   ```
   COUPANG_ACCESS_KEY=your_access_key
   COUPANG_SECRET_KEY=your_secret_key
   COUPANG_VENDOR_ID=your_vendor_id
   ```
2. 쿠팡 Wing 계정이 활성 상태인지 확인
3. API 키가 만료되지 않았는지 확인

### 2. 네이버 로그인 실패

**증상**: "네이버 로그인에 실패했습니다"

**해결 방법**:
1. 네이버 계정 정보가 올바른지 확인
2. 네이버 보안 설정 확인 (2단계 인증 등)
3. Chrome 브라우저가 설치되어 있는지 확인
4. 네트워크 연결 확인

### 3. 반품 처리 실패

**증상**: 일부 반품이 "failed" 상태

**해결 방법**:
1. 테이블에서 해당 반품 클릭하여 오류 메시지 확인
2. 네이버 스마트스토어에서 수동 확인
3. 상품명이 정확히 일치하는지 확인
4. 실패한 건만 다시 선택하여 재시도

### 4. 프론트엔드 연결 실패

**증상**: "서버에 연결할 수 없습니다"

**해결 방법**:
1. 백엔드 서버가 실행 중인지 확인 (http://localhost:8000)
2. 포트 8000이 다른 프로그램에 사용되고 있지 않은지 확인
3. 방화벽 설정 확인

### 5. 데이터베이스 오류

**증상**: "Database error"

**해결 방법**:
1. 백엔드 재시작
   ```bash
   cd backend
   start_server.bat
   ```
2. 데이터베이스 마이그레이션 재실행
   ```bash
   cd backend
   venv\Scripts\python.exe migrate_db.py
   ```

---

## 💡 사용 팁

### 1. 효율적인 반품 처리

- **정기 조회**: 매일 아침 "쿠팡에서 조회" 실행
- **배치 처리**: 비슷한 상태의 반품을 모아서 한 번에 처리
- **필터 활용**: "미처리" 필터로 처리할 건만 표시

### 2. 보안

- ⚠️ 네이버 계정 정보는 암호화되어 저장되지만, 중요 계정은 별도 관리 권장
- ⚠️ `.env` 파일을 Git에 커밋하지 마세요
- ⚠️ 정기적으로 API 키 갱신

### 3. 모니터링

- 통계 카드를 통해 처리 현황 파악
- 실패 건은 빠르게 확인하여 수동 처리

---

## 📞 지원

문제가 지속되면 다음을 확인하세요:

1. **로그 확인**
   - 백엔드 콘솔 출력
   - `backend/logs/app.log` 파일

2. **API 문서**
   - http://localhost:8000/docs
   - Swagger UI에서 API 직접 테스트

3. **데이터베이스 확인**
   - `backend/database/coupang_cs.db`
   - SQLite 브라우저로 직접 확인 가능

---

## 🎉 완료!

이제 반품 관리 시스템을 사용할 준비가 완료되었습니다.

**빠른 시작 순서**:
1. `START_ALL.bat` 실행
2. 네이버 계정 등록
3. 반품 관리 메뉴에서 "쿠팡에서 조회"
4. 처리할 반품 선택
5. "네이버 자동 처리" 클릭

행운을 빕니다! 🚀
