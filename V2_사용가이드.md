# 쿠팡윙 CS 자동화 V2 - 사용 가이드

## 🎉 새로운 V2 기능

실제 쿠팡윙 HTML 구조에 맞춰 완전히 새로 작성된 자동화 시스템입니다!

### V2 주요 개선사항

1. **시간대별 탭 자동 전환**
   - 72시간~30일 이내
   - 24~72시간
   - 24시간 이내
   - 모든 탭을 순회하며 문의 확인

2. **스마트 종료**
   - 모든 탭에 문의가 없으면 자동 종료
   - 불필요한 대기 시간 없음

3. **실제 HTML 구조 기반**
   - `<td data-v-7fedaa82 class="replying-no-comments">`
   - `<span class="inquiry-content">`
   - `<button>답변하기</button>`
   - `<textarea class="input-textarea">`
   - `<button>저장하기</button>`

4. **상세한 로깅**
   - 이모지를 활용한 직관적인 로그
   - 단계별 진행 상황 표시
   - 오류 발생 시 스크린샷 자동 저장

5. **무한 반복 처리**
   - 모든 문의를 찾아서 하나씩 처리
   - 더 이상 문의가 없을 때까지 반복

---

## 🚀 빠른 시작

### 1. 환경 설정 (`.env` 파일)

```env
# 필수 정보
COUPANG_WING_USERNAME=your_username@email.com
COUPANG_WING_PASSWORD=your_password
OPENAI_API_KEY=sk-your-api-key-here
OPENAI_MODEL=gpt-4
```

### 2. 서버 시작

```bash
# START.bat 더블클릭
```

### 3. V2 자동화 실행

#### 방법 1: API 직접 호출

```bash
curl -X POST "http://localhost:8000/api/wing-web/auto-answer-v2" \
  -H "Content-Type: application/json" \
  -d '{
    "headless": false
  }'
```

#### 방법 2: Python 스크립트

```python
import requests

response = requests.post(
    "http://localhost:8000/api/wing-web/auto-answer-v2",
    json={"headless": False}
)

print(response.json())
```

---

## 📊 실행 화면 예시

```
============================================================
🚀 쿠팡윙 CS 자동화 시작
============================================================
✅ 웹드라이버 설정 완료
🔐 쿠팡윙 로그인 시작...
  📝 아이디 입력...
  ✅ 아이디 입력 완료
  📝 비밀번호 입력...
  ✅ 비밀번호 입력 완료
  🖱️  로그인 버튼 클릭...
  ✅ 로그인 버튼 클릭 완료
  ⏳ 로그인 처리 중...
✅ 로그인 성공!
📋 고객문의 페이지로 이동...
✅ 고객문의 페이지 이동 완료
🔄 모든 탭 순회 시작...

============================================================
📂 [72시간~30일] 탭 처리 중...
============================================================
  🔍 '72시간~30일' 탭 확인 중...
  ✅ '72시간~30일' 탭 클릭 완료
  ✅ '72시간~30일' 탭에 3개 문의 발견!
    📥 문의 수집 중...
    📊 총 3개 행 발견
      ✅ 문의 1: 알코올 무함유 임산부 추천 폴린산...
      ✅ 문의 2: 유기농 비타민 D3 1000IU...
      ✅ 문의 3: 프리미엄 오메가3 180캡슐...
    ✅ 총 3개 유효한 문의 수집 완료

  📝 문의 1/3 처리 중...
    상품: 알코올 무함유 임산부 추천 폴린산 드롭 30ml 1개
    문의: 그러면.... 환불 받게 되는 건가요? 언제 그럼 취소가...
    💬 답변 작성 시작: 알코올 무함유 임산부 추천 폴린산...
      🖱️  답변하기 버튼 클릭...
      🤖 ChatGPT 답변 생성 중...
      ✅ ChatGPT 답변 생성 완료 (147자)
      📝 답변 입력란 찾는 중...
      ✍️  답변 입력 중...
      ✅ 답변 입력 완료 (147자)
      💾 저장하기 버튼 찾는 중...
      🖱️  저장하기 버튼 클릭...
    ✅ 답변 저장 완료!
    ✅ 문의 1 답변 완료!

  📝 문의 2/3 처리 중...
    ...

✅ [72시간~30일] 탭 처리 완료!

============================================================
📂 [24~72시간] 탭 처리 중...
============================================================
  🔍 '24~72시간' 탭 확인 중...
  ✅ '24~72시간' 탭 클릭 완료
  ℹ️  '24~72시간' 탭에 문의 없음

============================================================
📂 [24시간 이내] 탭 처리 중...
============================================================
  🔍 '24시간 이내' 탭 확인 중...
  ✅ '24시간 이내' 탭 클릭 완료
  ℹ️  '24시간 이내' 탭에 문의 없음

============================================================
📊 처리 완료 통계
============================================================
  총 문의 수: 3
  답변 완료: 3
  답변 실패: 0
  건너뜀: 0
============================================================
🧹 브라우저 종료 중...
✅ 브라우저 종료 완료
```

---

## 🔧 파라미터 설명

### `headless` (bool, default: True)

- `true`: 백그라운드 실행 (브라우저 창 보이지 않음)
- `false`: 브라우저 창을 보면서 실행 (디버깅/테스트용)

**권장 설정:**
- 테스트: `headless: false` (문제 확인 가능)
- 실제 운영: `headless: true` (빠르고 효율적)

---

## 📋 처리 흐름

```
1. 웹드라이버 설정
   ↓
2. 쿠팡윙 로그인
   ↓
3. 고객문의 페이지 이동
   ↓
4. 시간대별 탭 순회
   ├─ 72시간~30일
   ├─ 24~72시간
   └─ 24시간 이내
   ↓
5. 각 탭에서:
   - 문의 확인
   - 문의 없으면 다음 탭으로
   - 문의 있으면 모두 수집
   ↓
6. 각 문의별로:
   - 답변하기 버튼 클릭
   - ChatGPT로 답변 생성
   - 답변 입력
   - 저장하기 버튼 클릭
   ↓
7. 모든 탭 처리 완료
   ↓
8. 통계 출력 및 종료
```

---

## 🐛 디버깅

### 로그인 실패

```bash
# headless=false로 실행하여 직접 확인
curl -X POST "http://localhost:8000/api/wing-web/auto-answer-v2" \
  -d '{"headless": false}'

# 스크린샷 확인
# login_failed.png 또는 login_error.png 파일 확인
```

### 문의를 찾지 못함

```bash
# 1. headless=false로 실행
# 2. 실제 HTML 구조 확인
# 3. CSS 셀렉터 수정 필요시 wing_web_automation_v2.py 수정
```

### ChatGPT 오류

```env
# .env 파일 확인
OPENAI_API_KEY=sk-your-valid-api-key
OPENAI_MODEL=gpt-4  # 또는 gpt-3.5-turbo
```

---

## 📊 API 응답 예시

### 성공 시

```json
{
  "success": true,
  "message": "총 3개 문의 중 3개 답변 완료",
  "statistics": {
    "total_inquiries": 3,
    "answered": 3,
    "failed": 0,
    "skipped": 0
  }
}
```

### 문의 없음

```json
{
  "success": true,
  "message": "총 0개 문의 중 0개 답변 완료",
  "statistics": {
    "total_inquiries": 0,
    "answered": 0,
    "failed": 0,
    "skipped": 0
  }
}
```

### 오류 시

```json
{
  "detail": "로그인 실패"
}
```

---

## 🆚 V1 vs V2 비교

| 기능 | V1 | V2 ⭐ |
|------|----|----|
| 시간대별 탭 전환 | ❌ | ✅ |
| 자동 종료 (문의 없음) | ❌ | ✅ |
| 실제 HTML 구조 반영 | 부분적 | ✅ |
| 상세한 로깅 | 기본 | ✅ 이모지 |
| 무한 반복 처리 | 제한적 | ✅ |
| 스크린샷 디버깅 | ✅ | ✅ |

---

## 💡 사용 팁

### 1. 처음 실행 시

```bash
# headless=false로 실행하여 동작 확인
curl -X POST "http://localhost:8000/api/wing-web/auto-answer-v2" \
  -d '{"headless": false}'
```

### 2. 정기 실행

```bash
# headless=true로 빠르게 실행
curl -X POST "http://localhost:8000/api/wing-web/auto-answer-v2" \
  -d '{"headless": true}'
```

### 3. 스케줄러 설정 (매 1시간마다)

Python 스케줄러나 cron을 사용하여 자동 실행 설정 가능

---

## 🎯 다음 단계

1. `.env` 파일 설정
2. `START.bat` 실행
3. 로그인 테스트 (`/test-login`)
4. V2 자동화 실행 (`/auto-answer-v2`)
5. 결과 확인

---

**V2가 완전히 새로 작성되어 더 안정적이고 정확합니다!** 🎉
