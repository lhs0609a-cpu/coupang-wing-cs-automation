#!/bin/bash
# ====================================================================
# Coupang Wing CS ìë™í™” ì‹œìŠ¤í…œ - ì„œë²„ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (Mac/Linux)
# ====================================================================

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo ""
echo "===================================================================="
echo "ğŸš€ Coupang Wing CS ìë™í™” ì‹œìŠ¤í…œ ì‹œì‘"
echo "===================================================================="
echo ""

# ====================================================================
# 1. Python í™•ì¸
# ====================================================================
if ! command -v python3 &> /dev/null; then
    echo -e "${RED}âŒ Python3ì´ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.${NC}"
    echo "   ì„¤ì¹˜ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”: ./install.sh"
    exit 1
fi

# ====================================================================
# 2. ê°€ìƒí™˜ê²½ í™œì„±í™” (ìˆëŠ” ê²½ìš°)
# ====================================================================
if [ -f "backend/venv/bin/activate" ]; then
    echo "ğŸ”§ ê°€ìƒí™˜ê²½ í™œì„±í™” ì¤‘..."
    source backend/venv/bin/activate
fi

# ====================================================================
# 3. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í™•ì¸
# ====================================================================
if [ ! -f "backend/.env" ]; then
    echo -e "${YELLOW}âš ï¸  backend/.env íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.${NC}"
    echo ""
    echo "ğŸ’¡ ë¨¼ì € ì„¤ì¹˜ë¥¼ ì™„ë£Œí•˜ì„¸ìš”:"
    echo "   ./install.sh"
    echo ""
    exit 1
fi

# ====================================================================
# 4. í•„ìˆ˜ í´ë” í™•ì¸ ë° ìƒì„±
# ====================================================================
mkdir -p logs
mkdir -p data
mkdir -p error_reports
mkdir -p backend/logs

# ====================================================================
# 5. ì„œë²„ ì‹œì‘
# ====================================================================
echo ""
echo "ğŸŒŸ ì„œë²„ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
echo ""
echo "ì„œë²„ ì •ë³´:"
echo "  - ì£¼ì†Œ: http://localhost:8080"
echo "  - API ë¬¸ì„œ: http://localhost:8080/docs"
echo "  - ì¤‘ë‹¨: Ctrl+C"
echo ""
echo "===================================================================="
echo ""

cd backend
python3 -m uvicorn app.main:app --host 0.0.0.0 --port 8080 --reload

# ì„œë²„ ì¢…ë£Œ ì‹œ ë©”ì‹œì§€
echo ""
echo "===================================================================="
echo "â¹ï¸  ì„œë²„ê°€ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤."
echo "===================================================================="
echo ""
